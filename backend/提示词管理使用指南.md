# 提示词管理使用指南

本文档介绍如何使用多套提示词管理系统来优化和改进报告生成效果。

## 概述

系统支持多套提示词模板，可以通过环境变量配置选择使用哪个版本，方便测试不同提示词的效果并持续优化。

## 提示词版本说明

### 版本对比

| 版本 | 文件名 | 特点 | 适用场景 |
|------|--------|------|----------|
| `default` | `system_prompt.md` | 深度分析，结构化框架 | 需要详细分析的研究报告 |
| `v1` | `system_prompt_v1.md` | 深度分析，多角度思考 | 复杂问题的深度研究 |
| `v2` | `system_prompt_v2.md` | 简洁实用，四维框架 | 快速生成实用报告 |
| `v3` | `system_prompt_v3.md` | 创新思维，前瞻性分析 | 需要创新解决方案的研究 |

### 详细说明

#### default/v1 版本 - 深度分析型
- **特点**: 提供详细的分析框架，包含内容理解、问题关联、深度洞察、多角度思考
- **优势**: 分析全面，逻辑清晰，适合学术研究
- **适用**: 需要深入分析的研究问题

#### v2 版本 - 简洁实用型
- **特点**: 四维分析框架（关键信息提取、问题解答、实践应用、价值评估）
- **优势**: 结构简洁，重点突出，实用性强
- **适用**: 需要快速生成实用建议的场景

#### v3 版本 - 创新思维型
- **特点**: 创新分析框架，包含深度洞察、问题重构、解决方案创新、价值创造
- **优势**: 前瞻性强，创新思维，适合战略规划
- **适用**: 需要创新解决方案的复杂问题

## 使用方法

### 1. 配置提示词版本

在 `.env` 文件中设置 `PROMPT_VERSION` 参数：

```env
# 提示词配置
PROMPT_VERSION=v2  # 可选值: default, v1, v2, v3
```

### 2. 重启服务

修改配置后需要重启服务才能生效：

```bash
# 停止当前服务
Ctrl+C

# 重新启动
python main.py
```

### 3. 验证配置

通过API接口验证当前使用的提示词版本：

```bash
# 获取当前提示词信息
curl http://localhost:8000/api/v1/prompts/current

# 获取所有可用版本
curl http://localhost:8000/api/v1/prompts/versions
```

## 测试和优化流程

### 1. 创建测试数据集

准备一些典型的PDF文档和研究问题，用于测试不同提示词的效果。

### 2. 对比测试

```bash
# 测试 v1 版本
PROMPT_VERSION=v1 python main.py

# 测试 v2 版本
PROMPT_VERSION=v2 python main.py

# 测试 v3 版本
PROMPT_VERSION=v3 python main.py
```

### 3. 效果评估

从以下维度评估不同提示词的效果：

- **内容质量**: 分析的深度和准确性
- **结构清晰度**: 报告的逻辑结构和可读性
- **实用性**: 建议的可操作性和价值
- **创新性**: 解决方案的新颖程度
- **一致性**: 不同文档生成报告的一致性

### 4. 持续优化

基于测试结果，可以：

1. **调整现有版本**: 修改提示词内容，优化特定方面
2. **创建新版本**: 针对特定场景创建专门的提示词
3. **版本组合**: 根据文档类型自动选择最合适的版本

## 自定义提示词

### 1. 创建新版本

在 `app/prompts/` 目录下创建新的提示词文件：

```bash
# 创建新版本
cp app/prompts/system_prompt.md app/prompts/system_prompt_v4.md
```

### 2. 编辑提示词

编辑新文件，按照以下模板结构：

```markdown
# 智能文档研究助手系统提示词 v4.0

你是一个专业的文档研究助手，擅长分析PDF文档内容并生成结构化的研究报告。

## 任务描述
基于用户提供的研究问题和PDF文档片段，生成高质量的Markdown格式研究报告。

## 用户问题
{question}

## PDF文档片段内容
{chunk_content}

## 输出要求
# 在这里定义你的分析框架和要求

## 输出示例
# 提供具体的输出示例

## 注意事项
# 列出重要的注意事项
```

### 3. 注册新版本

新版本会自动被系统发现，无需额外配置。重启服务后即可使用：

```env
PROMPT_VERSION=v4
```

## 最佳实践

### 1. 版本命名规范

- 使用语义化版本号：`v1`, `v2`, `v3`
- 或使用描述性名称：`deep_analysis`, `quick_summary`, `innovation_focused`

### 2. 提示词设计原则

- **明确目标**: 清楚定义期望的输出格式和质量
- **结构化**: 使用清晰的框架指导分析过程
- **可扩展**: 设计灵活的模板，适应不同内容
- **可测试**: 包含具体的评估标准

### 3. 测试策略

- **A/B测试**: 对比不同版本的效果
- **用户反馈**: 收集用户对不同版本的评价
- **指标监控**: 跟踪关键指标（生成时间、质量评分等）

### 4. 版本管理

- **版本控制**: 使用Git管理提示词文件
- **变更记录**: 记录每个版本的改进点
- **回滚机制**: 保留历史版本，支持快速回滚

## 故障排除

### 常见问题

1. **提示词版本不存在**
   - 检查文件名是否正确
   - 确认文件在 `app/prompts/` 目录下
   - 重启服务重新加载

2. **格式化失败**
   - 检查模板参数是否完整
   - 确认占位符格式正确：`{parameter_name}`
   - 查看日志获取详细错误信息

3. **缓存问题**
   - 重启服务清除缓存
   - 或调用 `prompt_manager.reload_prompts()` 方法

### 调试方法

```python
# 在代码中调试提示词管理器
from app.prompts.prompt_manager import prompt_manager

# 查看可用版本
print(prompt_manager.get_available_versions())

# 测试加载特定版本
content = prompt_manager.load_prompt('v2')
print(content)

# 测试格式化
formatted = prompt_manager.format_prompt('v2', 
    question="测试问题", 
    chunk_content="测试内容", 
    max_tokens=500
)
print(formatted)
```

## 总结

多套提示词管理系统为报告生成提供了灵活性和可扩展性。通过合理使用不同版本的提示词，可以根据具体需求生成最适合的报告内容。建议定期测试和优化提示词，持续提升报告质量。 