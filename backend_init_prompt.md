# ğŸ¯ é¡¹ç›®åˆå§‹åŒ– Promptï¼šDeepResearch FastAPI åç«¯æœåŠ¡

## ğŸ§© ä¸šåŠ¡èƒŒæ™¯ä¸ç›®æ ‡
æœ¬é¡¹ç›®ä¸º DeepResearch æ™ºèƒ½æ–‡æ¡£ç ”ç©¶åŠ©æ‰‹çš„åç«¯ï¼Œèšç„¦äº PDF ç ”ç©¶æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆä¸šåŠ¡ã€‚ç›®æ ‡æ˜¯æ”¯æŒ PDF è§£æã€åˆ†ç‰‡ã€Prompt æ¸²æŸ“ã€LLM è°ƒç”¨ã€Markdown æŠ¥å‘Šæ‹¼æ¥ã€å…ƒæ•°æ®ç®¡ç†ã€æŠ¥å‘Šä¸‹è½½ã€æç¤ºè¯å¤šç‰ˆæœ¬ç®¡ç†ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œæä¾›é«˜å¯ç”¨ã€é«˜å¯ç»´æŠ¤çš„ API æœåŠ¡ã€‚

## ğŸ’¡ æ ¸å¿ƒèƒ½åŠ›
- æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„ PDF å’Œç ”ç©¶é—®é¢˜ï¼Œå®Œæˆ PDF åˆ†ç‰‡è§£æ
- æŒ‰ç…§ç³»ç»Ÿ Prompt æ¨¡æ¿æ¸²æŸ“ï¼Œè°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå†…å®¹
- æ‹¼æ¥ Markdown å†…å®¹ä¸ºå®Œæ•´æŠ¥å‘Šï¼Œä¿å­˜å…ƒæ•°æ®
- æä¾› RESTful API ä¾›å‰ç«¯è°ƒç”¨
- æ”¯æŒå¤š Prompt æ¨¡æ¿çµæ´»æ‰©å±•ï¼Œæ”¯æŒç‰ˆæœ¬åˆ‡æ¢
- æ”¯æŒæ¯ä¸ªç‰‡æ®µè¾“å‡ºæœ€å¤§ token æ•°ï¼ˆé»˜è®¤500ï¼‰
- æ”¯æŒæŠ¥å‘Šä¸‹è½½ï¼ˆContent-Disposition æ”¯æŒä¸­æ–‡æ ‡é¢˜ï¼‰
- å®Œæ•´æ—¥å¿—ã€å¼‚å¸¸å¤„ç†ã€è¿›åº¦åé¦ˆ

---

## ğŸ›  æŠ€æœ¯é€‰å‹
- **FastAPI**ï¼šé«˜æ€§èƒ½ Web æ¡†æ¶
- **Pydantic**ï¼šæ•°æ®æ¨¡å‹ä¸æ ¡éªŒ
- **Loguru**ï¼šæ—¥å¿—ç³»ç»Ÿ
- **python-dotenv**ï¼šç¯å¢ƒå˜é‡é…ç½®
- **pytest**ï¼šæµ‹è¯•æ¡†æ¶
- **openai / deep-api-sdk**ï¼šå¤§æ¨¡å‹ API è°ƒç”¨
- **PyMuPDF / pdfplumber**ï¼šPDF å†…å®¹æå–ä¸åˆ†ç‰‡

---

## ğŸ“‚ æ¨èé¡¹ç›®ç»“æ„
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                # FastAPI å…¥å£
â”‚   â”œâ”€â”€ core/                  # é…ç½®ã€æ—¥å¿—
â”‚   â”œâ”€â”€ routers/               # ç ”ç©¶æ¥å£è·¯ç”±ï¼ˆå¦‚ /generate_reportï¼‰
â”‚   â”œâ”€â”€ models/                # Prompt æ¨¡å‹ä¸è§£æ
â”‚   â”œâ”€â”€ schemas/               # è¯·æ±‚ä¸å“åº”ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ services/              # Prompt æ„å»ºã€PDF è§£æã€æŠ¥å‘Šç”Ÿæˆç­‰
â”‚   â”œâ”€â”€ prompts/               # ä¸»ç³»ç»Ÿ Prompt æ¨¡æ¿ï¼ˆå¤šç‰ˆæœ¬æ‰©å±•ï¼‰
â”‚   â””â”€â”€ utils/                 # æ–‡ä»¶ä¸Šä¼ ã€æ ¼å¼è½¬æ¢ã€ä¸´æ—¶ç¼“å­˜ç­‰
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡ï¼ˆAPI keyã€Prompt ç‰ˆæœ¬ç­‰ï¼‰
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ tests/                     # å•å…ƒæµ‹è¯•
â””â”€â”€ README.md
```

---

## ğŸ§¬ æ ¸å¿ƒä¸šåŠ¡æµç¨‹
1. ç”¨æˆ·ä¸Šä¼  PDF å¹¶è¾“å…¥ç ”ç©¶é—®é¢˜ï¼ˆmultipart/form-dataï¼Œå­—æ®µï¼šfileã€questionï¼‰
2. ç³»ç»Ÿæ¥æ”¶å¹¶æ ¡éªŒç”¨æˆ·è¾“å…¥çš„åˆæ³•æ€§
3. PDF è§£æä¸è¯­ä¹‰åˆ†ç‰‡ï¼ˆPyMuPDF/pdfplumberï¼Œè¯­ä¹‰å®Œæ•´ä¼˜å…ˆï¼‰
4. åŠ è½½ç³»ç»Ÿ Prompt æ¨¡æ¿ï¼ˆæ”¯æŒå¤šç‰ˆæœ¬ï¼Œä½äº app/prompts/ï¼‰
5. å°†ç”¨æˆ·é—®é¢˜ã€PDF ç‰‡æ®µå†…å®¹å¡«å……åˆ° Prompt æ¨¡æ¿ï¼Œå‡†å¤‡å¤§æ¨¡å‹å‚æ•°
6. ä¾æ¬¡å¯¹æ¯ä¸ª PDF ç‰‡æ®µè°ƒç”¨å¤§æ¨¡å‹ APIï¼Œæ§åˆ¶æ¯ç‰‡æ®µæœ€å¤§ token æ•°
7. æ”¶é›†å„ç‰‡æ®µç”Ÿæˆçš„ Markdown æ ¼å¼å†…å®¹
8. æŒ‰é¡ºåºæ‹¼æ¥æ‰€æœ‰ç‰‡æ®µå†…å®¹ï¼Œæ„å»ºå®Œæ•´ç»“æ„åŒ– Markdown ç ”ç©¶æŠ¥å‘Š
9. ä¿å­˜æŠ¥å‘ŠåŠå…ƒæ•°æ®ï¼Œè¿”å›æŠ¥å‘Š ID
10. æ”¯æŒæŠ¥å‘Šä¸‹è½½ï¼ˆContent-Disposition æ”¯æŒä¸­æ–‡æ ‡é¢˜ï¼Œå‰ç«¯å¯è‡ªåŠ¨å‘½åï¼‰
11. æ”¯æŒæŠ¥å‘Šè¯¦æƒ…ã€åˆ—è¡¨ã€åˆ é™¤ã€Prompt ç‰ˆæœ¬ç®¡ç†ç­‰æ¥å£

---

## ğŸ§© å…¸å‹æ¥å£å®šä¹‰
- `POST /generate_report`ï¼šç”ŸæˆæŠ¥å‘Š
- `GET /download_report/{report_id}`ï¼šä¸‹è½½æŠ¥å‘Šï¼ˆContent-Disposition æ”¯æŒä¸­æ–‡æ ‡é¢˜ï¼‰
- `GET /reports`ï¼šæŠ¥å‘Šåˆ—è¡¨
- `GET /reports/{report_id}`ï¼šæŠ¥å‘Šè¯¦æƒ…
- `GET /prompts/versions`ï¼šå¯ç”¨ Prompt ç‰ˆæœ¬
- `GET /prompts/info/{version}`ï¼šPrompt ç‰ˆæœ¬è¯¦æƒ…
- `GET /prompts/current`ï¼šå½“å‰ Prompt ä¿¡æ¯

---

## ğŸ§ª ä¸šåŠ¡ç›¸å…³æµ‹è¯•å»ºè®®
- ç»“åˆ `backend_test_best_practice_prompt.md`ï¼Œè¡¥å……ï¼š
  - å¦‚ä½• mock LLM å“åº”ã€PDF åˆ†ç‰‡ã€Prompt æ¸²æŸ“
  - å¦‚ä½•æ–­è¨€æŠ¥å‘Šå†…å®¹ã€å…ƒæ•°æ®ã€ä¸‹è½½æ–‡ä»¶åã€æ¥å£å“åº”ç­‰
  - å¦‚ä½•è¦†ç›–å¼‚å¸¸æµç¨‹ï¼ˆå¦‚åˆ†ç‰‡å¤±è´¥ã€LLM è¶…æ—¶ã€ä¸‹è½½ç¼–ç ç­‰ï¼‰
  - å…¸å‹é›†æˆæµ‹è¯•ï¼šä¸Šä¼ â†’åˆ†ç‰‡â†’ç”Ÿæˆâ†’æ‹¼æ¥â†’ä¸‹è½½å…¨é“¾è·¯

---

## âœ… æ¨èå®è·µ
- æ¯ç§ Prompt ä½¿ç”¨ç‹¬ç«‹ markdown æ¨¡æ¿ï¼Œå­˜æ”¾åœ¨ app/prompts/
- å„ç±»ä¸šåŠ¡é€»è¾‘å°è£…åœ¨ services å±‚ï¼Œé¿å… routers è‡ƒè‚¿
- æ”¯æŒ mock è°ƒç”¨ä¸çœŸå® LLM è°ƒç”¨è§£è€¦
- æ‰€æœ‰è¯·æ±‚å“åº”ç»“æ„ç»Ÿä¸€é‡‡ç”¨ code/msg/data ä¸‰æ®µå¼ schema
- æ—¥å¿—æ”¯æŒ request_idï¼Œä¾¿äºé“¾è·¯è¿½è¸ª
- æ¨¡æ¿ä¸­æ¯æ®µè¾“å‡ºæ”¯æŒæœ€å¤§ token é™åˆ¶ï¼Œé»˜è®¤500ï¼Œå¯é…ç½®

> âš ï¸ æµ‹è¯•ä½“ç³»ã€mockã€CI è¯·ç»“åˆã€Šbackend_test_best_practice_prompt.mdã€‹ç‹¬ç«‹ç”Ÿæˆã€‚